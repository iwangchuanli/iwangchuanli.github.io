<hr>
<p>title: MySQL学习-03-经典例题实践<br>abbrlink: 20676<br>tags:</p>
<ul>
<li>sql</li>
<li>教程</li>
<li>mysql<br>categories: </li>
<li>MySQL<br>date: 2018-11-26 17:45:53</li>
</ul>
<hr>
<pre><code>SQL方面的经典例题实践。
</code></pre>
<h3 id="数据库建库语句"><a href="#数据库建库语句" class="headerlink" title="数据库建库语句"></a>数据库建库语句</h3><pre><code>use fuxi;

CREATE TABLE STUDENT
(
  SNO       VARCHAR(3) NOT NULL,
  SNAME     VARCHAR(4) NOT NULL,
  SSEX      VARCHAR(2) NOT NULL,
  SBIRTHDAY DATETIME,
  CLASS     VARCHAR(5)
);

CREATE TABLE COURSE
(
  CNO   VARCHAR(5)  NOT NULL,
  CNAME VARCHAR(10) NOT NULL,
  TNO   VARCHAR(10) NOT NULL
);

CREATE TABLE SCORE
(
  SNO    VARCHAR(3)     NOT NULL,
  CNO    VARCHAR(5)     NOT NULL,
  DEGREE NUMERIC(10, 1) NOT NULL
);

CREATE TABLE TEACHER
(
  TNO       VARCHAR(3)  NOT NULL,
  TNAME     VARCHAR(4)  NOT NULL,
  TSEX      VARCHAR(2)  NOT NULL,
  TBIRTHDAY DATETIME    NOT NULL,
  PROF      VARCHAR(6),
  DEPART    VARCHAR(10) NOT NULL
);
</code></pre>
<h3 id="数据库数据录入"><a href="#数据库数据录入" class="headerlink" title="数据库数据录入"></a>数据库数据录入</h3><pre><code>INSERT INTO STUDENT (SNO, SNAME, SSEX, SBIRTHDAY, CLASS) VALUES (108, &#39;曾华&#39;
  , &#39;男&#39;, &#39;1977-09-01&#39;, 95033);
INSERT INTO STUDENT (SNO, SNAME, SSEX, SBIRTHDAY, CLASS) VALUES (105, &#39;匡明&#39;
  , &#39;男&#39;, &#39;1975-10-02&#39;, 95031);
INSERT INTO STUDENT (SNO, SNAME, SSEX, SBIRTHDAY, CLASS) VALUES (107, &#39;王丽&#39;
  , &#39;女&#39;, &#39;1976-01-23&#39;, 95033);
INSERT INTO STUDENT (SNO, SNAME, SSEX, SBIRTHDAY, CLASS) VALUES (101, &#39;李军&#39;
  , &#39;男&#39;, &#39;1976-02-20&#39;, 95033);
INSERT INTO STUDENT (SNO, SNAME, SSEX, SBIRTHDAY, CLASS) VALUES (109, &#39;王芳&#39;
  , &#39;女&#39;, &#39;1975-02-10&#39;, 95031);
INSERT INTO STUDENT (SNO, SNAME, SSEX, SBIRTHDAY, CLASS) VALUES (103, &#39;陆君&#39;
  , &#39;男&#39;, &#39;1974-06-03&#39;, 95031);

INSERT INTO COURSE (CNO, CNAME, TNO) VALUES (&#39;3-105&#39;, &#39;计算机导论&#39;, 825);
INSERT INTO COURSE (CNO, CNAME, TNO) VALUES (&#39;3-245&#39;, &#39;操作系统&#39;, 804);
INSERT INTO COURSE (CNO, CNAME, TNO) VALUES (&#39;6-166&#39;, &#39;数据电路&#39;, 856);
INSERT INTO COURSE (CNO, CNAME, TNO) VALUES (&#39;9-888&#39;, &#39;高等数学&#39;, 100);

INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (103, &#39;3-245&#39;, 86);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (105, &#39;3-245&#39;, 75);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (109, &#39;3-245&#39;, 68);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (103, &#39;3-105&#39;, 92);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (105, &#39;3-105&#39;, 88);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (109, &#39;3-105&#39;, 76);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (101, &#39;3-105&#39;, 64);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (107, &#39;3-105&#39;, 91);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (101, &#39;6-166&#39;, 85);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (107, &#39;6-106&#39;, 79);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (108, &#39;3-105&#39;, 78);
INSERT INTO SCORE (SNO, CNO, DEGREE) VALUES (108, &#39;6-166&#39;, 81);

INSERT INTO TEACHER (TNO, TNAME, TSEX, TBIRTHDAY, PROF, DEPART)
VALUES (804, &#39;李诚&#39;, &#39;男&#39;, &#39;1958-12-02&#39;, &#39;副教授&#39;, &#39;计算机系&#39;);
INSERT INTO TEACHER (TNO, TNAME, TSEX, TBIRTHDAY, PROF, DEPART)
VALUES (856, &#39;张旭&#39;, &#39;男&#39;, &#39;1969-03-12&#39;, &#39;讲师&#39;, &#39;电子工程系&#39;);
INSERT INTO TEACHER (TNO, TNAME, TSEX, TBIRTHDAY, PROF, DEPART)
VALUES (825, &#39;王萍&#39;, &#39;女&#39;, &#39;1972-05-05&#39;, &#39;助教&#39;, &#39;计算机系&#39;);
INSERT INTO TEACHER (TNO, TNAME, TSEX, TBIRTHDAY, PROF, DEPART)
VALUES (831, &#39;刘冰&#39;, &#39;女&#39;, &#39;1977-08-14&#39;, &#39;助教&#39;, &#39;电子工程系&#39;);
</code></pre>
<ul>
<li><p>1、 查询Student表中的所有记录的Sname、Ssex和Class列。</p>
<pre><code>  select SNAME,SSEX,CLASS from STUDENT;
</code></pre>
</li>
<li><p>2、 查询教师所有的单位即不重复的Depart列。</p>
<pre><code>  select distinct DEPART from TEACHER1;
</code></pre>
</li>
<li><p>3、 查询Student表的所有记录。</p>
<pre><code>  select * from STUDENT;
</code></pre>
</li>
<li><p>4、 查询Score表中成绩在60到80之间的所有记录。</p>
<pre><code>  select *
  from SCORE
  where DEGREE &gt; 60 and DEGREE &lt; 80;
</code></pre>
</li>
<li><p>5、 查询Score表中成绩为85，86或88的记录。</p>
<pre><code>  select *
  from SCORE
  where DEGREE = 85 or DEGREE = 86 or DEGREE = 88;
</code></pre>
</li>
<li><p>6、 查询Student表中“95031”班或性别为“女”的同学记录。</p>
<pre><code>  select *
  from STUDENT
  where CLASS = &#39;95031&#39; or SSEX = &#39;女&#39;;
</code></pre>
</li>
<li><p>7、 以Class降序查询Student表的所有记录。</p>
<pre><code>  select *
  from STUDENT
  order by CLASS desc;
</code></pre>
</li>
<li><p>8、 以Cno升序、Degree降序查询Score表的所有记录。</p>
<pre><code>  select *
  from SCORE
  order by CNO asc, DEGREE desc;
</code></pre>
</li>
<li><p>9、 查询“95031”班的学生人数。</p>
<pre><code>  select count(*)
  from STUDENT
  where CLASS = &#39;95031&#39;;
</code></pre>
</li>
<li><p>10、查询Score表中的最高分的学生学号和课程号。</p>
<pre><code>  select
    sno,
    CNO
  from SCORE
  where DEGREE = (
    select max(DEGREE)
    from SCORE
  );
</code></pre>
</li>
<li><p>11、查询‘3-105’号课程的平均分。</p>
<pre><code>  select avg(DEGREE)
  from SCORE
  where CNO = &#39;3-105&#39;;
</code></pre>
</li>
<li><p>12、查询Score表中至少有5名学生选修的并以3开头的课程的平均分数。</p>
<pre><code>  select
    avg(DEGREE),
    CNO
  from SCORE
  where cno like &#39;3%&#39;
  group by CNO
  having count(*) &gt; 5;
</code></pre>
</li>
<li><p>13、查询最低分大于70，最高分小于90的Sno列。</p>
<pre><code>  select SNO
  from SCORE
  group by SNO
  having min(DEGREE) &gt; 70 and max(DEGREE) &lt; 90;
</code></pre>
</li>
<li><p>14、查询所有学生的Sname、Cno和Degree列。</p>
<pre><code>  select
    SNAME,
    CNO,
    DEGREE
  from STUDENT, SCORE
  where STUDENT.SNO = SCORE.SNO;
</code></pre>
</li>
<li><p>15、查询所有学生的Sno、Cname和Degree列。</p>
<pre><code>  select
    SCORE.SNO,
    CNO,
    DEGREE
  from STUDENT, SCORE
  where STUDENT.SNO = SCORE.SNO;
</code></pre>
</li>
<li><p>16、查询所有学生的Sname、Cname和Degree列。</p>
<pre><code>  SELECT
    A.SNAME,
    B.CNAME,
    C.DEGREE
  FROM STUDENT A
    JOIN (COURSE B, SCORE C)
      ON A.SNO = C.SNO AND B.CNO = C.CNO;
</code></pre>
</li>
<li><p>17、查询“95033”班所选课程的平均分。</p>
<pre><code>  select avg(DEGREE)
  from SCORE
  where sno in (select SNO
                from STUDENT
                where CLASS = &#39;95033&#39;);
</code></pre>
</li>
<li><p>18、假设使用如下命令建立了一个grade表：</p>
<pre><code>  create table grade (
    low  numeric(3, 0),
    upp  numeric(3),
    rank char(1)
  );
  insert into grade values (90, 100, &#39;A&#39;);
  insert into grade values (80, 89, &#39;B&#39;);
  insert into grade values (70, 79, &#39;C&#39;);
  insert into grade values (60, 69, &#39;D&#39;);
  insert into grade values (0, 59, &#39;E&#39;);
</code></pre>
</li>
<li><p>现查询所有同学的Sno、Cno和rank列。</p>
<pre><code>  SELECT
    A.SNO,
    A.CNO,
    B.RANK
  FROM SCORE A, grade B
  WHERE A.DEGREE BETWEEN B.LOW AND B.UPP
  ORDER BY RANK;
</code></pre>
</li>
<li><p>19、查询选修“3-105”课程的成绩高于“109”号同学成绩的所有同学的记录。</p>
<pre><code>  select *
  from SCORE
  where CNO = &#39;3-105&#39; and DEGREE &gt; ALL (
    select DEGREE
    from SCORE
    where SNO = &#39;109&#39;
  );

  set @@global.sql_mode = &#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;;
  set sql_mode = &#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;;
</code></pre>
</li>
<li><p>20、查询score中选学一门以上课程的同学中分数为非最高分成绩的记录</p>
<pre><code>  select *
  from SCORE
  where DEGREE &lt; (select MAX(DEGREE)
                  from SCORE)
  group by SNO
  having count(*) &gt; 1;
</code></pre>
</li>
<li><p>21、查询成绩高于学号为“109”、课程号为“3-105”的成绩的所有记录。</p>
<pre><code>  同19
</code></pre>
</li>
<li><p>22、查询和学号为108的同学同年出生的所有学生的Sno、Sname和Sbirthday列。</p>
<pre><code>  select
    SNO,
    SNAME,
    SBIRTHDAY
  from STUDENT
  where year(SBIRTHDAY) = (
    select year(SBIRTHDAY)
    from STUDENT
    where SNO = &#39;108&#39;
  );
</code></pre>
</li>
<li><p>23、查询“张旭“教师任课的学生成绩。</p>
<pre><code>  select *
  from SCORE
  where cno = (
    select CNO
    from COURSE
      inner join TEACHER on COURSE.TNO = TEACHER.TNO and TNAME = &#39;张旭&#39;
  );
</code></pre>
</li>
<li><p>24、查询选修某课程的同学人数多于5人的教师姓名。</p>
<pre><code>  select TNAME
  from TEACHER
  where TNO = (
    select TNO
    from COURSE
    where CNO = (select CNO
                 from SCORE
                 group by CNO
                 having count(SNO) &gt; 5)
  );
</code></pre>
</li>
<li><p>25、查询95033班和95031班全体学生的记录。</p>
<pre><code>  select *
  from STUDENT
  where CLASS in (&#39;95033&#39;, &#39;95031&#39;);
</code></pre>
</li>
<li><p>26、查询存在有85分以上成绩的课程Cno.</p>
<pre><code>  select cno
  from SCORE
  group by CNO
  having MAX(DEGREE) &gt; 85;
</code></pre>
</li>
<li><p>27、查询出“计算机系“教师所教课程的成绩表。</p>
<pre><code>  select *
  from SCORE
  where CNO in (select CNO
                from TEACHER, COURSE
                where DEPART = &#39;计算机系&#39; and COURSE.TNO = TEACHER.TNO);
</code></pre>
</li>
<li><p>28、查询“计算机系”与“电子工程系“不同职称的教师的Tname和Prof</p>
<pre><code>  select
    tname,
    prof
  from TEACHER
  where depart = &#39;计算机系&#39; and prof not in (
    select prof
    from TEACHER
    where depart = &#39;电子工程系&#39;
  );
</code></pre>
</li>
<li><p>29、查询选修编号为“3-105“课程且成绩至少高于选修编号为“3-245”的同学的Cno、Sno和Degree,并按Degree从高到低次序排序。</p>
<pre><code>  select
    CNO,
    SNO,
    DEGREE
  from SCORE
  where CNO = &#39;3-105&#39; and DEGREE &gt; any (
    select DEGREE
    from SCORE
    where CNO = &#39;3-245&#39;
  )
  order by DEGREE desc;
</code></pre>
</li>
<li><p>30、查询选修编号为“3-105”且成绩高于选修编号为“3-245”课程的同学的Cno、Sno和Degree.</p>
<pre><code>  SELECT *
  FROM SCORE
  WHERE DEGREE &gt; ALL (
    SELECT DEGREE
    FROM SCORE
    WHERE CNO = &#39;3-245&#39;
  )
  ORDER by DEGREE desc;
</code></pre>
</li>
<li><p>31、查询所有教师和同学的name、sex和birthday.</p>
<pre><code>  select
    TNAME     name,
    TSEX      sex,
    TBIRTHDAY birthday
  from TEACHER
  union
  select
    sname     name,
    SSEX      sex,
    SBIRTHDAY birthday
  from STUDENT;
</code></pre>
</li>
<li><p>32、查询所有“女”教师和“女”同学的name、sex和birthday.</p>
<pre><code>  select
    TNAME     name,
    TSEX      sex,
    TBIRTHDAY birthday
  from TEACHER
  where TSEX = &#39;女&#39;
  union
  select
    sname     name,
    SSEX      sex,
    SBIRTHDAY birthday
  from STUDENT
  where SSEX = &#39;女&#39;;
</code></pre>
</li>
<li><p>33、查询成绩比该课程平均成绩低的同学的成绩表。</p>
<pre><code>  SELECT A.*
  FROM SCORE A
  WHERE DEGREE &lt; (SELECT AVG(DEGREE)
                  FROM SCORE B
                  WHERE A.CNO = B.CNO);
</code></pre>
</li>
<li><p>34、查询所有任课教师的Tname和Depart.</p>
<pre><code>  select
    TNAME,
    DEPART
  from TEACHER a
  where exists(select *
               from COURSE b
               where a.TNO = b.TNO);
</code></pre>
</li>
<li><p>35、查询所有未讲课的教师的Tname和Depart.</p>
<pre><code>  select
    TNAME,
    DEPART
  from TEACHER a
  where tno not in (select tno
                    from COURSE);
</code></pre>
</li>
<li><p>36、查询至少有2名男生的班号。</p>
<pre><code>  select CLASS
  from STUDENT
  where SSEX = &#39;男&#39;
  group by CLASS
  having count(SSEX) &gt; 1;
</code></pre>
</li>
<li><p>37、查询Student表中不姓“王”的同学记录。</p>
<pre><code>  select *
  from STUDENT
  where SNAME not like &quot;王%&quot;;
</code></pre>
</li>
<li><p>38、查询Student表中每个学生的姓名和年龄。</p>
<pre><code>  select
    SNAME,
    year(now()) - year(SBIRTHDAY)
  from STUDENT;
</code></pre>
</li>
<li><p>39、查询Student表中最大和最小的Sbirthday日期值。</p>
<pre><code>  select min(SBIRTHDAY) birthday
  from STUDENT
  union
  select max(SBIRTHDAY) birthday
  from STUDENT;
</code></pre>
</li>
<li><p>40、以班号和年龄从大到小的顺序查询Student表中的全部记录。</p>
<pre><code>  select *
  from STUDENT
  order by CLASS desc, year(now()) - year(SBIRTHDAY) desc;
</code></pre>
</li>
<li><p>41、查询“男”教师及其所上的课程。</p>
<pre><code>  select *
  from TEACHER, COURSE
  where TSEX = &#39;男&#39; and COURSE.TNO = TEACHER.TNO;
</code></pre>
</li>
<li><p>42、查询最高分同学的Sno、Cno和Degree列。</p>
<pre><code>  select
    sno,
    CNO,
    DEGREE
  from SCORE
  where DEGREE = (select max(DEGREE)
                  from SCORE);
</code></pre>
</li>
<li><p>43、查询和“李军”同性别的所有同学的Sname.</p>
<pre><code>  select sname
  from STUDENT
  where SSEX = (select SSEX
                from STUDENT
                where SNAME = &#39;李军&#39;);
</code></pre>
</li>
<li><p>44、查询和“李军”同性别并同班的同学Sname.</p>
<pre><code>  select sname
  from STUDENT
  where (SSEX, CLASS) = (select
                           SSEX,
                           CLASS
                         from STUDENT
                         where SNAME = &#39;李军&#39;);
</code></pre>
</li>
<li><p>45、查询所有选修“计算机导论”课程的“男”同学的成绩表</p>
<pre><code>  select *
  from SCORE, STUDENT
  where SCORE.SNO = STUDENT.SNO and SSEX = &#39;男&#39; and CNO = (
    select CNO
    from COURSE
    where CNAME = &#39;计算机导论&#39;);
</code></pre>
</li>
</ul>
<ul>
<li>46、使用游标方式来同时查询每位同学的名字，他所选课程及成绩。</li>
</ul>
<pre><code>    declare
     cursor student_cursor is
      select S.SNO,S.SNAME,C.CNAME,SC.DEGREE as DEGREE
      from STUDENT S, COURSE C, SCORE SC
      where S.SNO=SC.SNO
      and SC.CNO=C.CNO;
    
      student_row student_cursor%ROWTYPE;
    
    begin
      open student_cursor;
       loop
        fetch student_cursor INTO student_row;
        exit when student_cursor%NOTFOUND;
         dbms_output.put_line( student_row.SNO || &#39;&#39; || 
    
    student_row.SNAME|| &#39;&#39; || student_row.CNAME || &#39;&#39; ||
    
    student_row.DEGREE);
       end loop;
      close student_cursor;
    END;
    / 
</code></pre>
<ul>
<li><p>47、 声明触发器指令，每当有同学转换班级时执行触发器显示当前和之前所在班级。</p>
<pre><code>  CREATE OR REPLACE TRIGGER display_class_changes 
  AFTER DELETE OR INSERT OR UPDATE ON student 
  FOR EACH ROW 
  WHEN (NEW.sno &gt; 0) 

  BEGIN 
     
     dbms_output.put_line(&#39;Old class: &#39; || :OLD.class); 
     dbms_output.put_line(&#39;New class: &#39; || :NEW.class); 
  END; 
  / 


  Update student
  set class=95031
  where sno=109;
</code></pre>
</li>
</ul>
<ul>
<li><p>48、 删除已设置的触发器指令</p>
<pre><code>  DROP TRIGGER display_class_changes;
</code></pre>
</li>
</ul>
